<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" />

    <link rel="stylesheet" href="styles.css" />

    <title>Health App</title>
  </head>
  <body>
    <!--=============== HEADER ===============-->
    <header class="header" id="header">
      <nav class="nav container">
        <a href="logSelection.html">
          <button class="data-entry-btn">Cancel</button>
        </a>
        <img src="Assets/chevron-left-purple.png"></img>
        <h1 class="data-date"> Nov 1, 2023</h1>
        <img src="Assets/chevron-right-purple.png"></img>
        <a href="logSelection.html">
          <button class="data-entry-btn" id="exercise-save-btn">Save</button>
        </a>

        <div class="nav-menu" id="nav-menu">
          <ul class="nav-list">
            <li class="nav-item">
              <a href="tips.html" class="nav-link">
                <i class="bx bx-bulb nav-icon"></i>
                <span class="nav-name">Tips</span>
              </a>
            </li>

            <li class="nav-item">
              <a href="exercise.html" class="nav-link">
                <i class="bx bx-run nav-icon"></i>
                <span class="nav-name">Exercise</span>
              </a>
            </li>

            <li class="nav-item">
              <a href="index.html" class="nav-link active-link">
                <i class="bx bx-calendar nav-icon"></i>
                <span class="nav-name">Calendar</span>
              </a>
            </li>

            <li class="nav-item">
              <a href="creature.html" class="nav-link">
                <i class="bx bxs-dog nav-icon"></i>
                <span class="nav-name">Creature</span>
              </a>
            </li>

            <li class="nav-item">
              <a href="profile.html" class="nav-link">
                <i class="bx bx-user-circle nav-icon"></i>
                <span class="nav-name">Profile</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </header>

    <!--======= LOG EXERCISE CONTENT =======-->
    <main class="content">
      <h2 class="entry-title">Log Exercise</h2>
      <div class="data-table-entry">
        <div class="input-align">
          <p style="padding-right: 65px">Activity</p>
          <input
            class="input"
            id="activity-input"
            type="text"
            style="width: 200px" />
          <img
            src="Assets/keyboard.png"
            alt="keyboard"
            id="keyboard"
            class="keyboardImg" />
        </div>
        <div class="input-align">
          <p>Duration (min)</p>
          <input
            class="input"
            id="duration-input"
            type="number"
            style="width: 200px" />
          <img
            src="Assets/numpad.png"
            alt="keyboard"
            id="numpad"
            class="keyboardImg" />
        </div>
        <div class="input-align">
          <p style="padding-right: 61px">Calories</p>
          <input
            class="input"
            id="exercise-cal-input"
            type="number"
            style="width: 200px" />
          <img
            src="Assets/numpad.png"
            alt="keyboard"
            id="numpad"
            class="keyboardImg" />
        </div>
      </div>
      <button class="data-entry-btn add-button" id="add-exercise-btn">Add</button>
      <table class="styled-table" id="exercise-table">
        <thead>
          <tr>
            <th width="30%">Activity</th>
            <th width="30%">Duration (min)</th>
            <th width="30%">Calories</th>
            <th width="10%"></th>
          </tr>
        </thead>
        <tbody id="exercise-table-body">
        </tbody>
      </table>
      <div class="total-row">
        <div class="input-align">
          <p>Total Duration:</p>
          <p id="display-total-dur"></p>
        </div>
        <div class="input-align">
          <p>Total Calories:</p>
          <p id="display-total-exercise-cal"></p>
        </div>
      </div>
    </main>

    <script>
      const addButton = document.getElementById("add-exercise-btn");
      const saveButton = document.getElementById("exercise-save-btn")
      var exerciseEntries = [];
      var totalDuration = 0;
      var totalCalories = 0;
      var entryId = 0;

      addButton.addEventListener("click", function () {
        const activityInput = document.getElementById("activity-input").value;
        const durationInput = document.getElementById("duration-input").value;
        const calInput = document.getElementById("exercise-cal-input").value;
        addRow(activityInput, durationInput, calInput, true);
      });

      saveButton.addEventListener("click", function () {
        localStorage.setItem("exerciseEntries", JSON.stringify(exerciseEntries));
        localStorage.setItem("totalDurExercise", totalDuration);
        localStorage.setItem("totalCalExercise", totalCalories);
      });

      window.onbeforeunload = function () {
        localStorage.setItem("exerciseEntries", JSON.stringify(exerciseEntries));
        localStorage.setItem("totalDurExercise", totalDuration);
        localStorage.setItem("totalCalExercise", totalCalories);
      };

      window.onload = function() {
        var storedExerciseEntries = JSON.parse(localStorage.getItem("exerciseEntries"));
        if (storedExerciseEntries) {
          storedExerciseEntries.forEach(function(entry, index) {
            addRow(entry.activity, entry.duration, entry.calories, false)
          });
        }
      };

      function addRow(activityInput, durationInput, calInput, newInput) {
        // Add exercise entry to array for storage
        var entry = {
          id: entryId,
          activity: activityInput,
          duration: durationInput,
          calories: calInput,
        };
        exerciseEntries.push(entry);

        // Add to total counts
        totalDuration += parseInt(durationInput);
        totalCalories += parseInt(calInput);

        var table = document.getElementById("exercise-table-body");

        // Create a new row and cells
        var newRow = table.insertRow(-1);
        var cell1 = newRow.insertCell(0);
        var cell2 = newRow.insertCell(1);
        var cell3 = newRow.insertCell(2);
        var cell4 = newRow.insertCell(3);

        // Set cell values with inputs
        cell1.textContent = activityInput;
        cell2.textContent = durationInput;
        cell3.textContent = calInput;

        var image = document.createElement("img");
        image.src = "Assets/trash-purple.png";
        image.onclick = function() {
            // Remove the row from the table
            var row = image.parentNode.parentNode;
            var table = row.parentNode;
            table.removeChild(row);
            totalCalories -= parseInt(calInput);
            totalDuration -= parseInt(durationInput);
            removeObjectById(entry.id);
            document.getElementById("display-total-dur").textContent = totalDuration + " min";
            document.getElementById("display-total-exercise-cal").textContent = totalCalories + " cal";
        };
        cell4.appendChild(image);

        // Clear input fields after adding row
        if (newInput) {
          document.getElementById("activity-input").value = "";
          document.getElementById("duration-input").value = "";
          document.getElementById("exercise-cal-input").value = "";
        }

        entryId++;
        document.getElementById("display-total-dur").textContent = totalDuration + " min";
        document.getElementById("display-total-exercise-cal").textContent = totalCalories + " cal";
      }

      function removeObjectById(id) {
        exerciseEntries = exerciseEntries.filter(function(obj) {
          return obj.id !== id;
        });
      }
      document.getElementById("display-total-dur").textContent = totalDuration + " min";
      document.getElementById("display-total-exercise-cal").textContent = totalCalories + " cal";
    </script>
  </body>
</html>
